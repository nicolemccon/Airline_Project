import sqlite3
import csv
import pandas as pd
import numpy as np
import itertools as it
from collections import Counter 
conn = sqlite3.connect("airline_seating.db")                                                                      #4SEATS
c = conn.cursor()

def countSeats():
	c.execute("SELECT COUNT(seat) FROM seating")
	for item in c:
		nseats = item[0]
		print("Number of seats on the plane:", nseats)
# 
	c.execute("SELECT COUNT(name) FROM seating WHERE name NOT LIKE '' ;")
	for item in c:
		nnames = item[0]
		print("Number of unavailable seats:", nnames)
# 
	c.execute("SELECT COUNT(name) FROM seating WHERE name LIKE '' ;")
	for item in c:
		navail= item[0]
		print("Number of available seats:", navail)  
		navail = nseats - nnames
	return nseats,nnames,navail


def checkEmptySeat():
	emptySeats={}
     
	for i in range(15):
		seat=[]
		c.execute("SELECT seat from seating where row = "+str(i+1)+" and name like '' ;")
		for item in c:
			seat.append(item[0])
			# print(str(i+1)+ " "+str(item))
		emptySeats[i+1]=seat
	print(emptySeats)
def bookSeats(emptySeats, nOfSeats, nameOfPerson):
	flag = False
	for row in emptySeats.keys():
		for i in range(4 - nOfSeats+1):
			if(emptySeats[row][i:i+nOfSeats].count(0)==0):
				c.execute("update seating set name = \'"+ nameOfPerson+"\' where row = "+ str(row) +" and seat in "+str(emptySeats[row][i:i+nOfSeats]).replace('[','(').replace(']',')')+" ;")
				print(nameOfPerson +" booked on Row "+str(row)+ " Seats "+str(emptySeats[row][i:i+nOfSeats]).replace('[','(').replace(']',')'))
				for seat in range(i+nOfSeats):
					emptySeats[row][seat]=0
				flag=True
				break
		if(flag):
			break
	print(emptySeats)
	
   
def csvread():
    with open("book.csv") as csvfile:
         bookings = csv.reader(csvfile, delimiter = ',')
         for row in bookings:
            name = str(row[0])
            passengers = (int(row[1]))
            return name,passengers
    
    			


def main():
    nseats,nnames,navail=countSeats()
    emptySeats=checkEmptySeat()
    # print(emptySeats)
    k=csvread()
    print(k)
    name_p=k[0]
    n_seats=k[1]
    bookSeats(emptySeats,n_seats,name_p)

if __name__ == '__main__':
	main()



#########################################################################################################the above is cleaned code 
import sqlite3
import csv
import pandas as pd
conn = sqlite3.connect("practice.db")                                                                      #4SEATS
c = conn.cursor()

#counting seats

c.execute("SELECT COUNT(seat) FROM seating")
for item in c:
    nseats = item[0]
    print("Number of seats on the plane:", nseats)

c.execute("SELECT COUNT(name) FROM seating WHERE name NOT LIKE '' ;")
for item in c:
    nnames = item[0]
    print("Number of unavailable seats:", nnames)

#db.execute("SELECT COUNT(name) FROM seating WHERE name LIKE '' ;")
#for obj in db:
 #   seat_a= obj[0]
  #  print("Number of available seats:", seat_a)  
#navail = nseats - nnames
#print("Number of available seats:", navail) """ just some refinement """
  
#seat letters and number of seats
"""c.execute("SELECT seat,count(*) from seating group by seat")
i=0
for obj in c:
    no_seats=obj[0]
    print(obj[0])
    i=i+1
print(i)
no_seats_in_row=i;"""
  

#rows and aisles

c.execute("SELECT seats FROM rows_cols;")
for item in c:
    seat_letters = item[0]
    seats_per_row = (len(seat_letters))
    print("Number of seats per row:", seats_per_row)
    print("Number of rows on the plane:", int(nseats/seats_per_row))
    
#list of empty seats

emptyseats = []
c.execute("SELECT * FROM seating WHERE name LIKE '' ;")                                                 #row|seat = primary key
for item in c:
    emptyseats.append(item)                                                                             #list of available seats
    emptyseats.sort()                                                                                   #sort by row number 
print(emptyseats)
 

df = pd.read_sql_query("SELECT * FROM seating;", conn)  # give the table name and the connection
print(df.head())

passengers_refused = 0

with open("5passenger.csv") as csvfile:
    bookings = csv.reader(csvfile, delimiter = ',')
    for row in bookings:
        name = row[0]
        passengers = (int(row[1]))
        print("Number of passengers for", name, "booking:", passengers)

        if passengers <= navail:  
            d = []
            for i in range(passengers):
                d.append(name)
            print("d",d)
            entries = ()
            navail -= len(d)
            print("navail", navail)
            #for j in range(len(d)):
                #for k in range()
                #c.execute("INSERT INTO seating VALUE ()")

        else:
            c = []
            for i in range(passengers):
                c.append(name)
            print("lengc",len(c))
            passengers_refused+=(len(c))
